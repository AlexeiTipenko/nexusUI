function initNX(){nx.addStylesheet(),transformCanvases(),nx.is_touch_device&&(document.addEventListener("touchmove",nx.blockMove,!0),document.addEventListener("touchstart",nx.blockMove,!0)),nx.onload(),nx.startPulse()}function transformCanvases(){var e=document.getElementsByTagName("canvas");for(i=0;i<e.length;i++){var l=e[i].getAttribute("nx"),t=0;for(j=0;j<nx.elemTypeArr.length;j++)nx.elemTypeArr[j]==l&&t++;if(nx.elemTypeArr.push(l),!e[i].id){var s=t+1;e[i].id=l+s}l&&(window[e[i].id]=new window[l](e[i].id))}}function getTemplate(e,l){if(e.canvasID=l,!document.getElementById(l)){var t=document.createElement("canvas");t.id=l,document.body.appendChild(t)}e.canvas=document.getElementById(l),e.context=e.canvas.getContext("2d"),e.canvas.height=window.getComputedStyle(document.getElementById(l),null).getPropertyValue("height").replace("px",""),e.canvas.width=window.getComputedStyle(document.getElementById(l),null).getPropertyValue("width").replace("px",""),e.height=parseInt(window.getComputedStyle(document.getElementById(l),null).getPropertyValue("height").replace("px","")),e.width=parseInt(window.getComputedStyle(document.getElementById(l),null).getPropertyValue("width").replace("px","")),300==e.width&&150==e.height&&(e.canvas.width=e.defaultSize.width,e.canvas.height=e.defaultSize.height,e.width=e.defaultSize.width,e.height=e.defaultSize.height),e.offset=new nx.canvasOffset(nx.findPosition(e.canvas).left,nx.findPosition(e.canvas).top),e.center={x:e.width/2,y:e.height/2},e.corners={TLx:0,TLy:0,TRx:this.width,TRy:0,BRx:this.width,BRy:this.height,BLx:0,BLy:this.height},e.lineWidth=2,e.padding=2,e.colors=new Object,e.colors.accent=nx.colors.accent,e.colors.fill=nx.colors.fill,e.colors.border=nx.colors.border,e.colors.accentborder=nx.colors.accentborder,e.colors.black=nx.colors.black,e.colors.white=nx.colors.white,e.colors.highlight=nx.colors.highlight,e.hexToRgb=nx.hexToRgb,e.clickPos=new nx.point(0,0),e.clickPos.touches=new Array,e.clicked=!1,e.value=0,e.val=new Object,e.nodePos=new Array,e.deltaMove=new Object,e.nxThrottlePeriod=nx.nxThrottlePeriod,e.nxThrottle=nx.nxThrottle,e.isBeingDragged=!1,e.isBeingResized=!1,e.label=!1,nx.addNxObject(e),e.isRecording=!1,e.tapeNum=0,e.recorder=null,nx.editmode,e.localObject="dial1",e.localParameter="value",e.getCursorPosition=nx.getCursorPosition,e.getTouchPosition=nx.getTouchPosition,e.is_touch_device="ontouchstart"in document.documentElement?!0:!1,e.drawLabel=nx.drawLabel,e.events=new Object,e.on=function(l,t){e.events[l]=t},e.emit=function(l,t){e.events[l]&&e.events[l](t)},e.off=function(l){e.events[l]&&(e.events[l]=null)},e.nxTransmit=function(l){if("object"==typeof l&&null!==l)for(var t in l)if("object"==typeof l[t]&&null!==l[t])for(var s in l[t])e.emit(t+"/"+s,l[t][s]);else e.emit(t,l[t]);else("number"==typeof l||"string"==typeof l)&&e.emit("value",l)},e.preClick=function(l){e.offset=new nx.canvasOffset(nx.findPosition(e.canvas).left,nx.findPosition(e.canvas).top),document.addEventListener("mousemove",e.preMove,!1),document.addEventListener("mouseup",e.preRelease,!1),e.clickPos=e.getCursorPosition(l,e.offset),e.clicked=!0,e.deltaMove.x=0,e.deltaMove.y=0,nx.editmode?(e.clickPos.x>e.width-20&&e.clickPos.y>e.height-20?e.isBeingResized=!0:(e.isBeingResized=!1,e.isBeingDragged=!0),globaldragid=e.canvasID,showSettings(),nx.isErasing&&e.destroy()):e.click(l),document.body.style.userSelect="none",document.body.style.mozUserSelect="none",document.body.style.webkitUserSelect="none"},e.preMove=function(t){var s=e.getCursorPosition(t,e.offset);if(e.deltaMove.y=s.y-e.clickPos.y,e.deltaMove.x=s.x-e.clickPos.x,e.clickPos=s,nx.editmode){if(e.isBeingResized)console.log("resizing..."),e.canvas.width=~~(e.clickPos.x/(canvasgridx/2))*(canvasgridx/2),e.canvas.height=~~(e.clickPos.y/(canvasgridy/2))*(canvasgridy/2),e.canvas.height=window.getComputedStyle(document.getElementById(l),null).getPropertyValue("height").replace("px",""),e.canvas.width=window.getComputedStyle(document.getElementById(l),null).getPropertyValue("width").replace("px",""),e.height=parseInt(window.getComputedStyle(document.getElementById(l),null).getPropertyValue("height").replace("px","")),e.width=parseInt(window.getComputedStyle(document.getElementById(l),null).getPropertyValue("width").replace("px","")),e.center={x:e.width/2,y:e.height/2},e.corners={TLx:0,TLy:0,TRx:this.width,TRy:0,BRx:this.width,BRy:this.height,BLx:0,BLy:this.height},e.init(),e.draw();else if(e.isBeingDragged){var i=~~((t.pageY-e.height/2)/canvasgridy)*canvasgridy,o=~~((t.pageX-e.width/2)/canvasgridx)*canvasgridx;e.canvas.style.top=i+"px",e.canvas.style.left=o+"px",e.offset=new nx.canvasOffset(nx.findPosition(e.canvas).left,nx.findPosition(e.canvas).top)}}else e.move(t)},e.preRelease=function(){document.removeEventListener("mousemove",e.preMove,!1),e.clicked=!1,nx.editmode?e.isBeingDragged=!1:e.release(),document.removeEventListener("mouseup",e.preRelease,!1),document.body.style.userSelect="text",document.body.style.mozUserSelect="text",document.body.style.webkitUserSelect="text"},e.preTouch=function(l){e.clickPos=e.getTouchPosition(l,e.offset),e.clicked=!0,e.deltaMove.x=0,e.deltaMove.y=0,nx.editmode?(nx.isResizing?e.isBeingResized=!0:e.isBeingDragged=!0,globaldragid=e.canvasID,showSettings(),nx.isErasing&&e.destroy()):e.touch(l)},e.preTouchMove=function(t){if(e.clicked){var s=e.getTouchPosition(t,e.offset);if(e.deltaMove.y=s.y-e.clickPos.y,e.deltaMove.x=s.x-e.clickPos.x,e.clickPos=s,nx.editmode)if(e.isBeingDragged){var i=~~((t.targetTouches[0].pageY-e.height/2)/canvasgridy)*canvasgridy,o=~~((t.targetTouches[0].pageX-e.width/2)/canvasgridx)*canvasgridx;e.canvas.style.top=i+"px",e.canvas.style.left=o+"px",e.offset=new nx.canvasOffset(nx.findPosition(e.canvas).left,nx.findPosition(e.canvas).top)}else e.isBeingResized&&(e.canvas.width=~~(t.targetTouches[0].pageX/(canvasgridx/2))*(canvasgridx/2),e.canvas.height=~~(t.targetTouches[0].pageY/(canvasgridy/2))*(canvasgridy/2),e.canvas.height=window.getComputedStyle(document.getElementById(l),null).getPropertyValue("height").replace("px",""),e.canvas.width=window.getComputedStyle(document.getElementById(l),null).getPropertyValue("width").replace("px",""),e.height=parseInt(window.getComputedStyle(document.getElementById(l),null).getPropertyValue("height").replace("px","")),e.width=parseInt(window.getComputedStyle(document.getElementById(l),null).getPropertyValue("width").replace("px","")),e.center={x:e.width/2,y:e.height/2},e.corners={TLx:0,TLy:0,TRx:this.width,TRy:0,BRx:this.width,BRy:this.height,BLx:0,BLy:this.height},e.init(),e.draw());else e.touchMove(t)}},e.preTouchRelease=function(l){if(l.targetTouches.length>=1){var t=e.getTouchPosition(l,e.offset);e.clickPos=t}else e.clicked=!1;nx.editmode?(e.isBeingDragged=!1,globaldragid=!1):e.touchRelease()},e.draw=function(){},e.click=function(){},e.move=function(){},e.release=function(){},e.touch=function(){e.click()},e.touchMove=function(){e.move()},e.touchRelease=function(){e.release()},e.adjustSizeIfDefault=function(){300==e.width&&150==e.height&&(e.canvas.width=e.defaultSize.width,e.canvas.height=e.defaultSize.height,e.width=e.defaultSize.width,e.height=e.defaultSize.height)},e.makeRoundedBG=function(){this.bgLeft=this.lineWidth,this.bgRight=this.width-this.lineWidth,this.bgTop=this.lineWidth,this.bgBottom=this.height-this.lineWidth,this.bgHeight=this.bgBottom-this.lineWidth,this.bgWidth=this.bgRight-this.lineWidth,nx.makeRoundRect(e.context,e.bgLeft,e.bgTop,e.bgWidth,e.bgHeight)},e.erase=function(){e.context.clearRect(0,0,e.width,e.height)},e.hideCursor=function(){e.canvas.style.cursor="none"},e.showCursor=function(){e.canvas.style.cursor="auto"},e.getName=function(){var e=/function (.{1,})\(/,l=e.exec(this.constructor.toString());return l&&l.length>1?l[1]:""},e.set=function(l,t){if("object"==typeof e.val&&"null"!==e.val){if("object"==typeof l&&"null"!==l)for(var s in l)e.val[s]=l[s]}else("string"==typeof e.val||"number"==typeof e.val)&&("object"==typeof l&&"null"!==l?(e.val=l.value,e.draw()):("string"==typeof l||"number"==typeof l)&&(e.val=l));e.draw(),t&&nx.transmit(e.val)},e.destroy=function(){nx.nxObjects[e.canvasID]=null;var l=nx.elemTypeArr.indexOf(this.getName());nx.elemTypeArr.splice(l,1),e.canvas.ontouchmove=null,e.canvas.ontouchend=null,e.canvas.onclick=null,e.canvas.onmousemove=null,e.canvas.onmouseoff=null,document.removeEventListener("mousemove",e.preMove,!1),document.removeEventListener("mouseup",e.preRelease,!1);var t=document.getElementById(e.canvasID);t.parentNode.removeChild(t),delete window[e.canvasID],e=null},nx.getHandlers(e)}function banner(target){var self=this;this.defaultSize={width:125,height:50},getTemplate(self,target),this.message1="Powered by",this.message2="* Nexus UI *",this.message3="nexusosc.com",this.init=function(){self.draw()},this.draw=function(){with(self.context)globalAlpha=.1,fillStyle=self.colors.accent,beginPath(),moveTo(0,10),lineTo(10,self.height/2+5),lineTo(0,self.height),lineTo(30,self.height),lineTo(30,10),fill(),moveTo(self.width-30,10),lineTo(self.width-30,self.height),lineTo(self.width,self.height),lineTo(self.width-10,self.height/2+5),lineTo(self.width,10),fill(),closePath(),globalAlpha=1,fillStyle=self.colors.accent,fillRect(15,0,self.width-30,self.height-10),fillStyle=self.colors.white,font=self.height/5+"px courier",textAlign="center",fillText(self.message1,self.width/2,self.height/3.3),fillText(self.message2,self.width/2,self.height/3.3*2),fillStyle=self.colors.black,beginPath(),moveTo(15,self.height-10),lineTo(30,self.height),lineTo(30,self.height-10),lineTo(15,self.height-10),fill(),moveTo(self.width-15,self.height-10),lineTo(self.width-30,self.height),lineTo(self.width-30,self.height-10),lineTo(self.width-15,self.height-10),fill(),closePath();this.click=function(){window.location="http://www.nexusosc.com"}}}function button(target){var self=this;this.defaultSize={width:100,height:100},getTemplate(self,target),this.value=1,this.val={press:0},this.mode="toggle";var imageButton=!1;this.image=null,this.imageHover=null,this.imageTouch=null,this.init=function(){self.width=self.canvas.width,self.height=self.canvas.height,this.image&&(imageButton=!0),self.draw()},this.draw=function(){with(self.context)clearRect(0,0,self.width,self.height),lineWidth=self.lineWidth,imageButton?self.val.press?self.imageTouch?drawImage(self.imageTouch,0,0):(fillStyle=self.colors.highlight,strokeStyle=self.colors.accent,drawImage(self.image,0,0),globalAlpha=.5,fillRect(0,0,self.width,self.height),strokeRect(0,0,self.width,self.height),globalAlpha=1):drawImage(self.image,0,0):(self.val.press?self.val.press&&(fillStyle=self.colors.accent,strokeStyle=self.colors.accent):(fillStyle=self.colors.fill,strokeStyle=self.colors.border),beginPath(),arc(self.center.x,self.center.y,Math.min(self.center.x,self.center.y)-self.lineWidth/2,0,2*Math.PI,!0),fill(),stroke(),closePath(),self.clicked&&"node"==self.mode&&(globalAlpha=.2,fillStyle="#fff",beginPath(),arc(self.val.x,self.val.y,Math.min(self.center.x,self.center.y)/2,0,2*Math.PI,!0),fill(),closePath(),globalAlpha=1)),self.drawLabel()},this.click=function(){self.val.press=self.value*nx.boolToVal(self.clicked),"node"==self.mode&&(self.val.x=self.clickPos.x,self.val.y=self.clickPos.y),self.nxTransmit(self.val),self.draw()},this.move=function(){"node"==self.mode&&(self.val.x=self.clickPos.x,self.val.y=self.clickPos.y,self.nxTransmit(self.val),self.draw())},this.release=function(){self.val.press=self.value*nx.boolToVal(self.clicked),("toggle"==self.mode||"node"==self.mode)&&self.nxTransmit(self.val),self.draw()},this.setImage=function(e){self.image=new Image,self.image.onload=function(){self.draw()},self.image.src=e,imageButton=!0},this.setHoverImage=function(e){self.imageHover=new Image,self.imageHover.onload=function(){self.draw()},self.imageHover.src=e},this.setTouchImage=function(e){self.imageTouch=new Image,self.imageTouch.onload=function(){self.draw()},self.imageTouch.src=e},this.init()}function colors(target){var self=this;this.defaultSize={width:200,height:200},getTemplate(self,target);var color_table,color_width=self.canvas.width-2*self.lineWidth,color_height=self.canvas.height-2*self.lineWidth,saturation=240;self.color=[0,0,0];var i;this.init=function(){for(color_table=new Array(color_width),i=0;i<color_table.length;i++)color_table[i]=new Array(color_height);for(i=0;color_width>i;i++)for(h=Math.round(240/color_width*i),j=0;color_height>j;j++)s=saturation,l=Math.round(100/color_height*j),color_table[i][j]=[h,s,l];self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)fillStyle=self.colors.fill,strokeStyle=self.colors.border,fill(),stroke();for(i=0;color_width>i;i++)for(j=0;color_height>j;j++)with(hue=color_table[i][j][0],sat=color_table[i][j][1],lum=color_table[i][j][2],self.context)beginPath(),fillStyle="hsl("+hue+", "+sat+"%, "+lum+"%)",fillRect(i+self.padding,j+self.padding,240/color_width,240/color_height),fill(),closePath();self.drawLabel()},this.drawColor=function(){with(self.context)fillStyle="rgb("+self.val.r+","+self.val.g+","+self.val.b+")",beginPath(),arc(self.width/8,self.height-self.height/8,self.width/10,0,2*Math.PI),fill(),closePath()},this.click=function(){var e=self.context.getImageData(self.clickPos.x,self.clickPos.y,1,1);self.val={r:e.data[0],g:e.data[1],b:e.data[2]},self.nxTransmit(self.val),self.drawColor()},this.move=function(e){self.click(e)}}function comment(target){var self=this;this.defaultSize={width:100,height:35},getTemplate(self,target),this.val={text:"comment"},this.sizeSet=!1,this.setSize=function(e){self.size=e,self.sizeSet=!0,self.draw()},this.init=function(){self.draw()},this.draw=function(){with(self.sizeSet||(self.size=Math.sqrt(self.width*self.height/self.val.text.length)),self.erase(),self.context)globalAlpha=1,fillStyle=self.colors.fill,fillRect(0,0,self.width,self.height),strokeStyle=self.colors.border,lineWidth=3,strokeStyle=self.colors.accent,strokeRect(0,0,self.width,self.height),beginPath(),moveTo(0,self.height),lineTo(self.width,self.height),strokeStyle=self.colors.accent,stroke(),closePath(),globalAlpha=1,fillStyle=self.colors.black,textAlign="left",font=self.size+"px Gill Sans";nx.wrapText(self.context,self.val.text,6,3+self.size,self.width-6,self.size)}}function dial(target){var self=this;this.defaultSize={width:100,height:100},getTemplate(self,target),this.circle_size=1,this.dial_position_length=6,this.accentWidth=this.width<101||this.width<101?1*this.lineWidth:2*this.lineWidth,this.val={value:0},this.responsivity=.005,this.toCartesian=nx.toCartesian,this.throttle=nx.throttle,this.clip=nx.clip,this.aniStart=0,this.aniStop=1,this.aniMove=.01,this.init=function(){return self.circle_size=Math.min(self.center.x,self.center.y)-self.lineWidth,self.dial_position_length=self.circle_size+self.lineWidth,self.width<101&&(self.dial_position_length--,self.dial_position_length--),self.draw(),1},this.draw=function(){var dial_angle=2*(1-self.val.value)*Math.PI+1.5*Math.PI,dial_position=2*(self.val.value+.25)*Math.PI,point=self.toCartesian(self.dial_position_length,dial_angle);with(self.isRecording&&self.recorder.write(self.tapeNum,self.val.value),self.context)clearRect(0,0,self.width,self.height),strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,beginPath(),arc(self.center.x,self.center.y,self.circle_size,0,2*Math.PI,!0),fill(),stroke(),closePath(),beginPath(),lineWidth=self.accentWidth,arc(self.center.x,self.center.y,self.circle_size,.5*Math.PI,dial_position,!1),lineTo(self.center.x,self.center.y),globalAlpha=.1,fillStyle=self.colors.accent,fill(),globalAlpha=1,closePath(),beginPath(),lineWidth=self.accentWidth,arc(self.center.x,self.center.y,self.circle_size,.5*Math.PI,dial_position,!1),strokeStyle=self.colors.accent,stroke(),closePath(),beginPath(),lineWidth=self.accentWidth,strokeStyle=self.colors.accent,moveTo(self.center.x,self.center.y),lineTo(point.x+self.center.x,point.y+self.center.y),stroke(),closePath(),beginPath(),fillStyle=self.colors.accent,arc(self.center.x,self.center.y,self.circle_size/8,0,2*Math.PI,!1),fill(),closePath();self.drawLabel()},this.click=function(){self.val.value=nx.prune(self.val.value,3),self.nxTransmit(self.val),self.draw(),self.aniStart=self.val.value},this.move=function(){self.val.value=self.clip(self.val.value-self.deltaMove.y*self.responsivity,0,1),self.val.value=nx.prune(self.val.value,3),self.nxTransmit(self.val),self.draw()},this.release=function(){self.aniStop=self.val.value},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){self.clicked||(self.val.value+=self.aniMove,self.aniStop<self.aniStart&&(self.stopPlaceholder=self.aniStop,self.aniStop=self.aniStart,self.aniStart=self.stopPlaceholder),self.aniMove=nx.bounce(self.val.value,self.aniStart,self.aniStop,self.aniMove),self.draw(),self.val.value=nx.prune(self.val.value,3),self.nxTransmit(self.val))},this.init()}function envelope(target){var self=this;this.defaultSize={width:100,height:100},getTemplate(self,target),this.nodeSize=5,this.on=!1,this.duration=1,this.val={x:.15,y:.5,amp:0,index:0},this.init=function(){self.actualWid=self.width-2*self.lineWidth-2*self.nodeSize,self.actualHgt=self.height-2*self.lineWidth-2*self.nodeSize,self.draw(),nx.aniItems.push(self.advance)},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill();var drawingX=self.val.x*self.actualWid+self.nodeSize+self.lineWidth,drawingY=self.val.y*self.actualHgt+self.nodeSize+self.lineWidth;with(drawingX<self.bgLeft+self.nodeSize?drawingX=self.bgLeft+self.nodeSize:drawingX>self.bgRight-self.nodeSize&&(drawingX=self.bgRight-self.nodeSize),drawingY<self.bgTop+self.nodeSize?drawingY=self.bgTop+self.nodeSize:drawingY>self.bgBottom-self.nodeSize&&(drawingY=self.bgBottom-self.nodeSize),self.context)beginPath(),strokeStyle=self.colors.accent,moveTo(self.padding,self.height-self.padding),lineTo(drawingX,drawingY),lineTo(self.width-self.padding,self.height-self.padding),stroke(),globalAlpha=.2,fillStyle=self.colors.accent,fill(),globalAlpha=1,closePath(),beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(drawingX,drawingY,self.nodeSize,0,2*Math.PI,!0),fill(),closePath(),globalAlpha=.1,fillRect(0,0,self.val.index*self.width,self.height),globalAlpha=1}self.drawLabel()},this.scaleNode=function(){var e=self.val.x-self.nodeSize-self.lineWidth,l=self.val.y-self.nodeSize-self.lineWidth,t=nx.clip(e/self.actualWid,0,1),s=nx.clip(l/self.actualHgt,0,1);self.val.x=nx.prune(t,3),self.val.y=nx.prune(s,3)},this.click=function(){self.val.x=self.clickPos.x,self.val.y=self.clickPos.y,self.scaleNode(),self.val.state="click",self.nxTransmit(self.val),self.draw()},this.move=function(){self.clicked&&(self.val.x=self.clickPos.x,self.val.y=self.clickPos.y,self.scaleNode(),self.nxTransmit(self.val),self.draw())},this.release=function(){self.val.x=self.clickPos.x,self.val.y=self.clickPos.y,self.scaleNode(),self.draw()},this.advance=function(){if(self.on){if(self.val.index+=33/self.width/self.duration,self.val.index<self.val.x){var e=self.val.index/self.val.x*(1-self.val.y);self.val.amp=Math.abs(e-1)}else{var e=(1-self.val.index)/(1-self.val.x)*(1-self.val.y);self.val.amp=Math.abs(e-1)}self.nxTransmit(self.val),self.draw(),self.val.index>=1&&self.stop()}},this.start=function(){self.on=!0,self.val.index=0},this.stop=function(){self.on=!1,self.val.index=0,self.draw()},this.continue=function(){}}function joints(target){var self=this;this.defaultSize={width:300,height:300},getTemplate(self,target),this.nodeSize=self.width/14,this.values=[0,0],this.val={x:0,y:0,node1:0},this.nodePos=[50,50],this.joints=[{x:self.width/1.2,y:self.height/1.2},{x:self.width/2,y:self.height/1.3},{x:self.width/4.2,y:self.height/1.1},{x:self.width/1.4,y:self.height/2.2},{x:self.width/2.1,y:self.height/1.8},{x:self.width/5,y:self.height/2.4},{x:self.width/2.8,y:self.height/6},{x:self.width/6,y:self.height/3.7}],this.threshold=self.width/3,this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.drawingX=self.val.x*self.width,self.drawingY=self.val.y*self.height,self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),null!=self.val.x?self.drawNode():(fillStyle=self.colors.border,font="14px courier",fillText(self.default_text,10,20)),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth;for(var i in self.joints){beginPath(),arc(self.joints[i].x,self.joints[i].y,self.nodeSize/2,0,2*Math.PI,!0),fill(),closePath();var cnctX=Math.abs(self.joints[i].x-self.drawingX),cnctY=Math.abs(self.joints[i].y-self.drawingY),strength=cnctX+cnctY;if(strength<self.threshold){beginPath(),moveTo(self.joints[i].x,self.joints[i].y),lineTo(self.drawingX,self.drawingY),strokeStyle=self.colors.accent,lineWidth=nx.scale(strength,0,self.threshold,self.nodeSize/2,5),stroke(),closePath();var scaledstrength=nx.scale(strength,0,self.threshold,1,0);self.val["node"+i]=scaledstrength}}}self.drawLabel()},this.drawNode=function(){with(self.drawingX<self.bgLeft+self.nodeSize?self.drawingX=self.bgLeft+self.nodeSize:self.drawingX>self.bgRight-self.nodeSize&&(self.drawingX=self.bgRight-self.nodeSize),self.drawingY<self.bgTop+self.nodeSize?self.drawingY=self.bgTop+self.nodeSize:self.drawingY>self.bgBottom-self.nodeSize&&(self.drawingY=self.bgBottom-self.nodeSize),self.context)globalAlpha=1,beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(self.drawingX,self.drawingY,self.nodeSize,0,2*Math.PI,!0),fill(),closePath()},this.scaleNode=function(){return self.values=[nx.prune(self.val.x/self.width,3),nx.prune(self.val.y/self.height,3)],self.values},this.click=function(){self.val=new Object,self.val.x=self.clickPos.x/self.width,self.val.y=self.clickPos.y/self.height,self.draw(),self.nxTransmit(self.val),self.connections=new Array},this.move=function(){if(self.val=new Object,self.clicked){self.val.x=self.clickPos.x/self.width,self.val.y=self.clickPos.y/self.height,self.draw();{({"self.clickPos.x":self.clickPos.x,"self.clickPos.y":self.clickPos.y,"self.val.x":self.val.x,"self.val.y":self.val.y,"self.offset":self.offset})}self.nxTransmit(self.val),self.connections=new Array}},this.release=function(){},this.touch=function(){self.val.x=self.clickPos.x/self.width,self.val.y=self.clickPos.y/self.height,self.draw(),self.nxTransmit(self.val),self.connections=new Array},this.touchMove=function(){self.clicked&&(self.val.x=self.clickPos.x/self.width,self.val.y=self.clickPos.y/self.height,self.draw(),self.nxTransmit(self.val),self.connections=new Array)},this.touchRelease=function(){},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){!self.clicked&&self.val.x&&(self.val.x+=self.deltaMove.x/2,self.val.y+=self.deltaMove.y/2,self.deltaMove.x=nx.bounce(self.val.x,self.bgLeft+self.nodeSize,self.width-self.bgLeft-self.nodeSize,self.deltaMove.x),self.deltaMove.y=nx.bounce(self.val.y,self.bgTop+self.nodeSize,self.height-self.bgTop-self.nodeSize,self.deltaMove.y),self.draw(),self.nxTransmit(self.scaleNode()))}}function keyboard(target){var self=this;this.defaultSize={width:300,height:75},getTemplate(self,target),self.octaves=2;var width=self.canvas.width/(12*self.octaves)/1.75,w_height=self.height,b_height=4*w_height/7,w_width=3*width,b_width=2*width,black_dis=[0,0,0,0,0,0,0,0,1,3,4,5],white_dis=[[0,2],[4,5],[7,9],[9,11],[13,14],[16,17],[19,21]],order=[0,2,4,5,7,9,11,1,3,6,8,10],keys=new Array;self.lineWidth=1;var note_new,note_old;this.val={on:0,note:0,midi:"0 0"},this.init=function(){document.addEventListener("keydown",self.type),document.addEventListener("keyup",self.untype),width=self.canvas.width/(12*self.octaves)/1.75,w_height=self.height,b_height=4*w_height/7,w_width=3*width,b_width=2*width;var e,l,t;for(l=0;l<self.octaves;l++)for(t=0;12>t;t++)if(e=order[t]+12*l,7>t){var s=w_width*(t+7*l),i=t+1,o=w_width*(i+7*l);keys.push([0,t,0,s,o,e])}else{var a=black_dis[t],n=b_width*(1+a+a/2)+7*l*w_width,f=a+1,h=b_width*(1+f+a/2)+7*l*w_width;keys.push([0,a,1,n,h,e])}return self.draw(),1},this.draw=function(){var m,i,d,xx,dis;for(m=0;m<self.octaves;m++)for(i=0;12>i;i++)if(d=12*m+i,0==keys[d][2]){var k=keys[d][1],x=k*w_width+m*w_width*7;with(self.context)lineWidth=self.lineWidth,0==keys[d][0]?(fillStyle=self.colors.fill,fillRect(x,0,w_width,w_height),strokeStyle=self.colors.border,strokeRect(x,0,w_width,w_height)):(fillStyle=self.colors.accent,fillRect(x,0,w_width,w_height))}else with(dis=keys[d][1],xx=dis*(b_width+b_width/2)+b_width+m*w_width*7,self.context)lineWidth=self.lineWidth,fillStyle=0==keys[d][0]?self.colors.black:self.colors.accent,fillRect(xx,0,b_width,b_height);with(self.context)strokeStyle=self.colors.border,lineWidth=3,strokeRect(0,0,self.width,self.height);self.drawLabel()},this.change_cell=function(e,l){null!=e&&keys[e].splice(0,1,l)},this.whichKey_pressed=function(e,l){var t,s,i,o=0;if(b_height>l)for(t=0;t<self.octaves;t++){for(s=7;12>s;s++){var a=12*t+s;if(e>keys[a][3]&&e<=keys[a][4]){note_new=a,o=1;break}}if(0==o)for(i=0;7>i;i++){var n=(white_dis[i][0]+21*t)*width,f=(white_dis[i][1]+21*t)*width;if(e>n&&f>=e){var h=12*t+i;note_new=h;break}}}else if(l>b_height&&w_height>l)for(t=0;t<self.octaves;t++)for(s=0;7>s;s++){var a=12*t+s;e>keys[a][3]&&e<keys[a][4]&&(note_new=a)}else note_new=null},this.click=function(){self.whichKey_pressed(self.clickPos.x,self.clickPos.y),self.change_cell(note_new,1),note_old=note_new,midi_note=keys[note_new][5],self.val={on:1,note:midi_note,midi:midi_note+" 1"},self.nxTransmit(self.val),self.draw()},this.move=function(){self.clicked&&(self.whichKey_pressed(self.clickPos.x,self.clickPos.y),note_old!=note_new&&(self.change_cell(note_old,0),self.change_cell(note_new,1),midi_note=keys[note_new][5],self.val={on:1,note:midi_note,midi:midi_note+" 1"},self.nxTransmit(self.val),midi_note=keys[note_old][5],self.val={on:0,note:midi_note,midi:midi_note+" 0"},self.nxTransmit(self.val),self.draw())),note_old=note_new},this.release=function(){for(j=0;j<self.octaves;j++)for(i=0;12>i;i++){var e=12*j+i;self.change_cell(e,0)}midi_note=keys[note_new][5],self.val={on:0,note:midi_note,midi:midi_note+" 0"},self.nxTransmit(self.val),self.draw()}}function matrix(target){var self=this;this.defaultSize={width:200,height:200},getTemplate(self,target);var i;this.row=3,this.col=3,this.off=3,this.cellHgt,this.cellWid,this.pos,this.matrix,this.val={row:0,col:0,value:0},this.init=function(){for(self.matrix=new Array(self.row),i=0;i<self.matrix.length;i++)self.matrix[i]=new Array(self.col);for(i=0;i<self.row;i++)for(j=0;j<self.col;j++)self.matrix[i][j]=0;self.draw()},this.draw=function(){with(this.cellWid=(this.canvas.width-2*this.off)/this.col,this.cellHgt=(this.canvas.height-2*this.off)/this.row,this.makeRoundedBG(),this.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=this.lineWidth;for(i=0;i<this.row;i++)for(j=0;j<this.col;j++){var st_x=j*this.cellWid+this.lineWidth,st_y=i*this.cellHgt+this.lineWidth,boxwid=(this.cellWid*this.matrix[i][j],this.cellHgt*this.matrix[i][j],(j+1)*this.cellWid+this.off/2,(i+1)*this.cellHgt+this.off+this.off/2,this.cellWid-this.lineWidth),boxhgt=this.cellHgt-this.lineWidth;with(nx.makeRoundRect(this.context,st_x,st_y,boxwid,boxhgt),this.context){if(strokeStyle=self.colors.border,fillStyle=self.colors.fill,stroke(),fill(),this.matrix[i][j]>0){var level=Math.abs(this.matrix[i][j]-1),x1=st_x,y1=st_y+this.cellHgt*level-5*level,x2=boxwid+x1,y2=boxhgt*this.matrix[i][j]+y1,depth=6;beginPath(),this.matrix[i][j]>.95?(moveTo(x1+depth,y1),lineTo(x2-depth,y1),quadraticCurveTo(x2,y1,x2,y1+depth)):(moveTo(x1,y1),lineTo(x2,y1)),lineTo(x2,y2-depth),quadraticCurveTo(x2,y2,x2-depth,y2),lineTo(x1+depth,y2),quadraticCurveTo(x1,y2,x1,y2-depth),this.matrix[i][j]>.95?(lineTo(x1,y1+depth),quadraticCurveTo(x1,y1,x1+depth,y1)):lineTo(x1,y1),closePath(),fillStyle=self.colors.accent,fill()}nx.makeRoundRect(this.context,st_x,st_y,boxwid,boxhgt),null!=self.place&&self.place==i*self.col+j&&(globalAlpha=.4,fillStyle=self.colors.accent,fill(),globalAlpha=1)}}self.drawLabel()};this.click=function(){self.cur={col:~~(self.clickPos.x/self.cellWid),row:~~(self.clickPos.y/self.cellHgt)},self.cur.value=self.clickPos.y-self.cellHgt*self.cur.row,self.cur.value=self.cur.value/self.cellHgt,self.cur.value=nx.invert(self.cur.value),self.cur.value<=.5&&(self.cur.value=0),self.matrix[self.cur.row][self.cur.col]=self.cur.value,self.nxTransmit(self.cur),self.draw()},this.move=function(e){self.clicked&&self.clickPos.y>=0&&self.click(e)},this.place=null,this.starttime,self.thisframe=0,self.lastframe=0,self.bpm=120,this.sequence=function(e){e&&(self.bpm=e),requestAnimationFrame(self.seqStep)},this.seqStep=function(){var e=(new Date).getTime(),l=e-nx.starttime;self.thisframe=~~(l/(6e4/self.bpm)),self.thisframe!=self.lastframe&&(null==self.place&&(self.place=0),self.draw(),self.cur={row:~~(self.place/self.col),col:self.place%self.row},self.cur.value=self.matrix[self.cur.row][self.cur.col],self.nxTransmit(self.cur),self.place++,self.place>=self.row*self.col&&(self.place=0)),self.lastframe=self.thisframe,requestAnimationFrame(self.seqStep)}}function message(target){var self=this;this.defaultSize={width:100,height:50},getTemplate(self,target),this.val={message:"send a message"},this.size=12,this.init=function(){self.canvas.getAttribute("label")&&(this.val.message=self.canvas.getAttribute("label")),self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context){strokeStyle=self.colors.border,fillStyle=self.clicked?self.colors.accent:self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),globalAlpha=.2;var grd=self.context.createLinearGradient(0,0,0,self.height);grd.addColorStop(0,self.colors.fill),grd.addColorStop(1,self.colors.black),fillStyle=grd,fill(),globalAlpha=1,fillStyle=self.colors.black,textAlign="left",font=self.size+"px courier"}nx.wrapText(self.context,self.val.message,5,1+self.size,self.width-6,self.size)},this.click=function(){self.draw(),self.nxTransmit(self.val)},this.release=function(){self.draw()}}function metroball(target){var self=this;this.defaultSize={width:300,height:200},getTemplate(self,target),this.CurrentBalls=new Array,this.UISpaces=new Array;var globalMetro,ballPos=new Object,clickField=null,tempo=1,quantize=!1,tilt=0;self.tiltLR,self.tiltFB,self.z;var i;this.val={bounce:""},this.init=function(){self.createUISpaces(),globalMetro=setInterval(self.canvasID+".pulse()",20),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(e){self.tiltLR=e.gamma,self.tiltFB=e.beta,self.z=e.alpha,self.tilt()},!1):window.OrientationEvent?window.addEventListener("MozOrientation",function(e){self.tiltLR=90*e.x,self.tiltFB=-90*e.y,self.z=e.z,self.tilt()},!1):console.log("Not supported on your device or browser.")},this.createUISpaces=function(){self.UISpaces=[{field:"main",xpos:5,ypos:45,wid:self.width-10,hgt:self.height-45-self.padding,hint:"click to add"},{field:"delete",xpos:45,ypos:5,wid:self.width-50,hgt:35,hint:"swipe to delete"},{field:"quantize",xpos:5,ypos:5,wid:35,hgt:35,hint:"Q"}];for(var e=0;e<self.UISpaces.length;e++)self.UISpaces[e].xpos2=self.UISpaces[e].xpos+self.UISpaces[e].wid,self.UISpaces[e].ypos2=self.UISpaces[e].ypos+self.UISpaces[e].hgt,self.UISpaces[e].centerx=self.UISpaces[e].xpos+self.UISpaces[e].wid/2,self.UISpaces[e].centery=self.UISpaces[e].ypos+self.UISpaces[e].hgt/2},this.pulse=function(){with(self.context)clearRect(0,0,self.width,self.height);self.drawSpaces(),self.drawBalls(),self.drawLabel()},this.drawSpaces=function(){with(self.context){for(lineWidth=3,strokeStyle=self.colors.border,fillStyle=self.colors.fill,i=0;i<self.UISpaces.length;i++){var space=self.UISpaces[i];
nx.makeRoundRect(self.context,space.xpos,space.ypos,space.wid,space.hgt),stroke(),"quantize"==space.field&&quantize?(fillStyle=self.colors.accent,fill(),fillStyle=self.colors.fill):fill()}for(lineWidth=2,fillStyle=self.colors.border,lineStyle="#ffffff",font="bold 14px courier",textAlign="center",i=0;i<self.UISpaces.length;i++){var space=self.UISpaces[i];fillText(space.hint,space.centerx,space.centery+5)}}},this.drawBalls=function(){with(self.context)for(i=0;i<self.CurrentBalls.length;i++)self.CurrentBalls[i].move(),self.CurrentBalls[i].draw()},this.click=function(){for(ballPos=self.clickPos,i=0;i<self.UISpaces.length;i++)nx.isInside(ballPos,self.UISpaces[i])&&(clickField=self.UISpaces[i].field);switch(clickField){case"main":self.addNewMB(ballPos);break;case"delete":self.deleteMB(ballPos);break;case"quantize":self.toggleQuantization()}},this.move=function(){switch(ballPos=self.clickPos,clickField){case"delete":self.deleteMB(ballPos);break;case"tempo":self.moveTempo(ballPos)}},this.release=function(){clickField=null},this.touch=function(e){self.click(e)},this.touchMove=function(e){self.move(e)},this.touchRelease=function(e){self.release(e)},this.deleteMB=function(e){for(i=self.CurrentBalls.length-1;i>=0;i--)Math.abs(self.CurrentBalls[i].xpos-e.x)<10&&self.CurrentBalls[i].kill();for(i=0;i<self.CurrentBalls.length;i++)self.CurrentBalls[i].SelfIndex=i},this.addNewMB=function(e){var l=self.CurrentBalls.length;self.CurrentBalls[l]=new self.Ball(l,e.x,e.y)},this.toggleQuantization=function(){quantize=quantize?!1:!0},this.tilt=function(){{var e=nx.prune(self.tiltLR/90,3),l=nx.prune(self.tiltFB/90,3);nx.prune(self.z,3)}tilt=10*e,tempo=Math.pow(l+1,3)},this.Ball=function(SelfIndex,SelfX,SelfY){this.SelfIndex=SelfIndex,this.space=self.UISpaces[0],this.color=self.colors.accent,this.xpos=SelfX,this.ypos=SelfY,this.size=10,this.direction=1,this.speed=(this.space.hgt-(this.ypos-this.space.ypos))/20,this.speedQ=5,quantize&&(this.ypos=this.space.hgt+13),this.move=function(){this.ypos=quantize?this.ypos+this.speedQ*this.direction*tempo:this.ypos+this.speed*this.direction*tempo,(this.ypos>this.space.ypos2-this.size-2||this.ypos<this.space.ypos+this.size+2)&&this.bounce(),this.ypos<this.space.ypos+this.size?this.ypos=this.space.ypos+this.size+5:this.ypos>this.space.ypos+this.space.hgt-this.size&&(this.ypos=this.space.ypos+this.space.hgt-this.size-5),this.xpos=this.xpos+tilt,this.xpos<this.space.xpos?this.xpos=this.space.xpos2:this.xpos>this.space.xpos2&&(this.xpos=this.space.xpos)},this.bounce=function(){this.direction/2+1;this.bounceside=(this.direction+1)/2,this.direction=-1*this.direction;var e=nx.prune(this.xpos/this.space.wid,3);this.val={x:e,side:this.bounceside,ball:this.SelfIndex,all:e+" "+this.bounceside+" "+this.SelfIndex},self.nxTransmit(this.val)},this.kill=function(){self.CurrentBalls.splice(this.SelfIndex,1)},this.draw=function(){with(self.context)beginPath(),fillStyle=this.color,1==this.direction?(this.radius=this.size*Math.abs((this.ypos-this.space.ypos-this.space.hgt/2)/(this.space.hgt-this.space.ypos)*2),this.radius=this.radius/2+this.size/2,this.radius=this.size,this.radius=this.speed,this.radius=Math.abs(15-this.speed)):(this.radius=this.size*Math.abs(2-Math.abs((this.ypos-this.space.ypos-this.space.hgt/2)/(this.space.hgt-this.space.ypos)*2)),this.radius=this.radius/2+this.size/2,this.radius=this.size,this.radius=Math.abs(15-this.speed)),arc(this.xpos,this.ypos,this.radius,0,2*Math.PI,!0),shadowColor=this.color,shadowBlur=2,fill(),shadowBlur=0}}}function mouse(target){var self=this;this.defaultSize={width:98,height:100},getTemplate(self,target),this.val={x:0,y:0,deltax:0,deltay:0},self.inside=new Object,this.init=function(){self.mousing=window.addEventListener("mousemove",self.preMove,!1),self.mousing=window.addEventListener("touchmove",self.preTouchMove,!1),self.inside.height=self.height-self.lineWidth,self.inside.width=self.width-self.lineWidth,self.inside.left=self.lineWidth,self.inside.top=self.lineWidth,self.inside.quarterwid=self.inside.width/4},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill();var scaledx=-self.val.x*self.height,scaledy=-self.val.y*self.height,scaleddx=-self.val.deltax*self.height-self.height/2,scaleddy=-self.val.deltay*self.height-self.height/2;fillStyle=self.colors.accent,fillRect(self.inside.left,self.inside.height,self.inside.quarterwid,scaledx),fillRect(self.inside.quarterwid,self.inside.height,self.inside.quarterwid,scaledy),fillRect(2*self.inside.quarterwid,self.inside.height,self.inside.quarterwid,scaleddx),fillRect(3*self.inside.quarterwid,self.inside.height,self.inside.quarterwid,scaleddy),globalAlpha=.5,fillStyle=self.colors.white,textAlign="center",font=self.width/7+"px gill sans",fillText("x",0*self.inside.quarterwid+self.inside.quarterwid/2,self.height-7),fillText("y",1*self.inside.quarterwid+self.inside.quarterwid/2,self.height-7),fillText("dx",2*self.inside.quarterwid+self.inside.quarterwid/2,self.height-7),fillText("dy",3*self.inside.quarterwid+self.inside.quarterwid/2,self.height-7),globalAlpha=1}self.drawLabel()},this.move=function(e){self.val={deltax:(e.clientX-document.body.scrollLeft)/window.innerWidth-self.val.x,deltay:(e.clientY-document.body.scrollTop)/window.innerHeight-self.val.y,x:(e.clientX-document.body.scrollLeft)/window.innerWidth,y:(e.clientY-document.body.scrollTop)/window.innerHeight},self.draw(),self.nxTransmit(self.val)}}function multislider(target){var self=this;this.defaultSize={width:300,height:200},getTemplate(self,target),this.sliders=15,this.val=new Object;for(var i=0;i<this.sliders;i++)this.val[i]=.7;this.sliderClicked=0,this.realSpace={x:self.width-2*self.padding,y:self.height-2*self.padding},this.sliderWidth=self.realSpace.x/self.sliders,this.oldSliderToMove,this.init=function(){self.realSpace={x:self.width-2*self.padding,y:self.height-2*self.padding},self.sliderWidth=self.realSpace.x/self.sliders,self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),this.context)for(strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),strokeStyle=this.colors.accent,fillStyle=this.colors.accent,lineWidth=5,i=0;i<self.sliders;i++)beginPath(),moveTo(self.padding+i*self.sliderWidth,self.height-self.val[i]*self.height),lineTo(self.padding+i*self.sliderWidth+self.sliderWidth,self.height-self.val[i]*self.height),stroke(),lineTo(self.padding+i*self.sliderWidth+self.sliderWidth,self.height-self.padding),lineTo(self.padding+i*self.sliderWidth,self.height-self.padding),globalAlpha=.3-i%3*.1,fill(),closePath(),globalAlpha=1;self.drawLabel()},this.click=function(){self.oldSliderToMove=!1,self.move()},this.move=function(){if(self.clicked){if(self.clickPos.touches.length>1)for(var e=0;e<self.clickPos.touches.length;e++){var l=Math.floor(self.clickPos.touches[e].x/self.sliderWidth);l=nx.clip(l,0,self.sliders-1),self.val[l]=nx.clip(nx.invert(self.clickPos.touches[e].y/self.height),0,1)}else{var l=Math.floor(self.clickPos.x/self.sliderWidth);l=nx.clip(l,0,self.sliders-1),self.val[l]=nx.clip(nx.invert(self.clickPos.y/self.height),0,1)}self.draw()}var t=new Object;t[l]=self.val[l],t.list=new String;for(var s in self.val)t.list+=self.val[s]+" ";self.nxTransmit(t),console.log(t)},this.setNumberOfSliders=function(e){this.sliders=e,this.values=new Array;for(var l=0;l<this.sliders;l++)this.values.push(.5);this.sliderWidth=self.realSpace.x/self.sliders,this.init()}}function multitouch(target){var self=this;this.defaultSize={width:300,height:300},getTemplate(self,target),this.nodeSize=self.width/10,this.val={touch1:{x:0,y:0}},this.nodes=new Array,this.default_text="multitouch",this.rainbow=["#00f","#04f","#08F","0AF","0FF"],this.mode="normal",this.rows=10,this.cols=10,this.matrixLabels=!1,this.init=function(){this.nodeSize=self.width/10,self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill();var count=0;if("matrix"==self.mode)for(var j=0;j<self.rows;j++)for(var i=0;i<self.cols;i++)with(self.context){beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=1;var circx=i*self.width/self.cols+self.width/self.cols/2,circy=j*self.height/self.rows+self.height/self.rows/2;arc(circx,circy,self.height/self.rows/2,0,2*Math.PI,!0),stroke(),fillStyle=self.colors.border,textAlign="center",textBaseline="middle",self.matrixLabels&&(fillText(self.matrixLabels[count%self.matrixLabels.length],circx,circy),count++);var thisarea={xpos:i*self.width/self.cols,ypos:j*self.height/self.rows,wid:self.width/self.cols,hgt:self.height/self.rows};if(self.clickPos.touches.length>=1)for(var k=0;k<self.clickPos.touches.length;k++)nx.isInside(self.clickPos.touches[k],thisarea)&&(globalAlpha=.5,fillStyle=self.colors.accent,fill(),globalAlpha=.3,fillStyle=self.rainbow[k],fill(),globalAlpha=1);closePath()}else if(self.clickPos.touches.length>=1)for(var i=0;i<self.clickPos.touches.length;i++)with(self.context)globalAlpha=.5,beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(self.clickPos.touches[i].x,self.clickPos.touches[i].y,self.nodeSize,0,2*Math.PI,!0),fill(),closePath(),globalAlpha=.3,beginPath(),fillStyle=self.rainbow[i],strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(self.clickPos.touches[i].x,self.clickPos.touches[i].y,self.nodeSize,0,2*Math.PI,!0),fill(),closePath(),globalAlpha=1;else fillStyle=self.colors.border,font="14px courier",textAlign="center",fillText(self.default_text,self.width/2,self.height/2)}self.drawLabel()},this.click=function(){self.draw(),self.sendit()},this.move=function(){self.clicked&&(self.draw(),self.sendit())},this.release=function(){if(!self.clicked){self.clickPos.touches=new Array;for(var e=0;5>e;e++)self.val["touch"+e]={x:0,y:0};self.nxTransmit(self.val)}self.draw(),self.sendit()},this.sendit=function(){self.val=new Object;for(var e=0;e<self.clickPos.touches.length;e++)self.val["touch"+e]={x:self.clickPos.touches[e].x/self.canvas.width,y:nx.invert(self.clickPos.touches[e].y/self.canvas.height)};self.nxTransmit(self.val)}}function number(target){var self=this;this.defaultSize={width:100,height:50},getTemplate(self,target),this.val=0,this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),fillStyle=self.colors.black,textAlign="left",font=.6*self.height+"px courier",textBaseline="middle",fillText(self.val,10,self.height/2-1)},this.move=function(){self.clicked&&(self.val+=self.deltaMove.y*-.1,self.val=nx.prune(self.val,1),self.draw(),self.nxTransmit(self.val))},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){!self.clicked&&self.nodePos[0]&&(self.nodePos[0]+=self.deltaMove.x/2,self.nodePos[1]+=self.deltaMove.y/2,self.deltaMove.x=nx.bounce(self.nodePos[0],self.bgLeft+self.nodeSize,self.width-self.bgLeft-self.nodeSize,self.deltaMove.x),self.deltaMove.y=nx.bounce(self.nodePos[1],self.bgTop+self.nodeSize,self.height-self.bgTop-self.nodeSize,self.deltaMove.y),self.draw(),self.nxTransmit(self.value))}}function panel(target){var self=this;this.defaultSize={width:100,height:100},getTemplate(self,target),this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill()}}function pixels(target){var self=this;this.defaultSize={width:300,height:300},getTemplate(self,target),self.dim={x:10,y:10},self.mode="write",this.init=function(){self.dim={x:~~(self.width/20),y:~~(self.height/20)},self.px={wid:(self.width-2*self.padding)/self.dim.x,hgt:(self.height-2*self.padding)/self.dim.y},self.screen=new Array;for(var e=0;e<self.dim.y;e++){self.screen[e]=new Array;for(var l=0;l<self.dim.x;l++)self.screen[e][l]=[0,0,0]}self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)fillStyle=self.colors.fill,strokeStyle=self.colors.border,fill(),stroke();self.drawLabel()},this.reset=function(){self.draw()},this.click=function(e){var pixX=~~(self.clickPos.x/self.px.wid),scaledX=pixX*self.px.wid+self.padding,pixY=~~(self.clickPos.y/self.px.hgt),scaledY=pixY*self.px.hgt+self.padding;if(self.lastpx={x:scaledX,y:scaledY},"write"==self.mode){with(self.context)globalAlpha=.3,fillStyle=self.colors.accent,fillRect(scaledX,scaledY,2*self.px.wid,2*self.px.hgt),globalAlpha=1;var imgData=self.context.getImageData(self.clickPos.x,self.clickPos.y,1,1);self.screen[pixY][pixX]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x+self.px.wid,self.clickPos.y,1,1);self.screen[pixY][pixX+1]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x,self.clickPos.y+self.px.hgt,1,1);self.screen[pixY+1][pixX]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x+self.px.wid,self.clickPos.y+self.px.hgt,1,1);self.screen[pixY+1][pixX+1]=[imgData.data[0],imgData.data[1],imgData.data[2]]}self.send(pixX,pixY)},this.move=function(){var pixX=~~(self.clickPos.x/self.px.wid);pixX=nx.clip(pixX,0,self.dim.x-2);var scaledX=pixX*self.px.wid+self.padding,pixY=~~(self.clickPos.y/self.px.hgt);pixY=nx.clip(pixY,0,self.dim.y-2);var scaledY=pixY*self.px.hgt+self.padding;if(scaledX!=self.lastpx.x||scaledY!=self.lastpx.y){if(self.lastpx={x:scaledX,y:scaledY},"write"==self.mode){with(self.context)globalAlpha=.1,fillStyle=self.colors.accent,fillRect(scaledX,scaledY,2*self.px.wid,2*self.px.hgt),globalAlpha=1;var imgData=self.context.getImageData(self.clickPos.x,self.clickPos.y,1,1);self.screen[pixY][pixX]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x+self.px.wid,self.clickPos.y,1,1);self.screen[pixY][pixX+1]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x,self.clickPos.y+self.px.hgt,1,1);self.screen[pixY+1][pixX]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x+self.px.wid,self.clickPos.y+self.px.hgt,1,1);self.screen[pixY+1][pixX+1]=[imgData.data[0],imgData.data[1],imgData.data[2]]}self.send(pixX,pixY)}},this.release=function(){},this.touch=function(e){self.click(e)},this.touchMove=function(e){self.move(e)},this.touchRelease=function(e){self.release(e)},this.send=function(e,l){if("write"==self.mode){for(var t="",s=0;s<self.screen.length;s++){var i=self.screen[s].join();t+=i.replace(/\,/g," "),t+=" "}var o={matrix:t};self.nxTransmit(o)}else if("read"==self.mode){var o={r:self.screen[l][e][0],g:self.screen[l][e][1],b:self.screen[l][e][2]};self.nxTransmit(o)}}}function position(target){var self=this;this.defaultSize={width:300,height:200},getTemplate(self,target),this.nodeSize=15,this.val={x:self.width/2,y:self.height/2},this.default_text="touch to control",this.init=function(){this.nodeSize=self.width/15,self.actualWid=self.width-2*self.lineWidth-2*self.nodeSize,self.actualHgt=self.height-2*self.lineWidth-2*self.nodeSize,self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill();var drawingX=self.val.x*self.actualWid+self.nodeSize+self.lineWidth,drawingY=self.val.y*self.actualHgt+self.nodeSize+self.lineWidth;with(drawingX<self.bgLeft+self.nodeSize?drawingX=self.bgLeft+self.nodeSize:drawingX>self.bgRight-self.nodeSize&&(drawingX=self.bgRight-self.nodeSize),drawingY<self.bgTop+self.nodeSize?drawingY=self.bgTop+self.nodeSize:drawingY>self.bgBottom-self.nodeSize&&(drawingY=self.bgBottom-self.nodeSize),self.context)globalAlpha=.2,beginPath(),strokeStyle=self.colors.accent,lineWidth=2,moveTo(drawingX,0+self.padding),lineTo(drawingX,self.height-self.padding),moveTo(0+self.padding,drawingY),lineTo(self.width-self.padding,drawingY),stroke(),closePath(),globalAlpha=1,beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(drawingX,drawingY,self.nodeSize,0,2*Math.PI,!0),fill(),closePath()}self.drawLabel()},this.scaleNode=function(){var e=self.val.x-self.nodeSize-self.lineWidth,l=self.val.y-self.nodeSize-self.lineWidth,t=nx.clip(e/self.actualWid,0,1),s=nx.clip(l/self.actualHgt,0,1);self.val.x=nx.prune(t,3),self.val.y=nx.prune(s,3)},this.click=function(){self.val.x=self.clickPos.x,self.val.y=self.clickPos.y,self.scaleNode(),self.val.state="click",self.nxTransmit(self.val),self.draw()},this.move=function(){self.clicked&&(self.val.x=self.clickPos.x,self.val.y=self.clickPos.y,self.scaleNode(),self.val.state="move",self.nxTransmit(self.val),self.draw())},this.release=function(){self.val.x=self.clickPos.x,self.val.y=self.clickPos.y,self.scaleNode(),self.val.state="release",self.nxTransmit(self.val),self.draw()},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){!self.clicked&&self.val.x&&(self.val.x+=self.deltaMove.x/2/self.width,self.val.y+=self.deltaMove.y/2/self.height,self.val.state="animated",nx.bounce(self.val.x,0,1,self.deltaMove.x)!=self.deltaMove.x&&(self.deltaMove.x=nx.bounce(self.val.x,0,1,self.deltaMove.x),self.val.state="bounce"),nx.bounce(self.val.y,0,1,self.deltaMove.y)!=self.deltaMove.y&&(self.deltaMove.y=nx.bounce(self.val.y,0,1,self.deltaMove.y),self.val.state="bounce"),self.nxTransmit(self.val),self.draw())}}function range(target){var self=this;this.defaultSize={width:50,height:200},getTemplate(self,target),this.val={start:.3,stop:.7},this.hslider=!1,self.handle,self.relhandle,self.cap,this.init=function(){self.hslider=self.height>=self.width?!1:!0,this.realSpace={x:self.width-2*self.lineWidth,y:self.height-2*self.lineWidth},null!=this.canvas.getAttribute("label")&&(this.label=this.canvas.getAttribute("label")),self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),this.context)if(strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),fillStyle=this.colors.accent,self.hslider){var x1=self.lineWidth+self.val.start*self.realSpace.x,y1=self.lineWidth,x2=self.lineWidth+self.val.stop*self.realSpace.x,y2=self.height-self.lineWidth;fillRect(x1,y1,x2-x1,y2-y1),nx.showLabels&&(textAlign="center",textBaseline="middle",font="bold 15px courier",fillStyle=self.colors.accent,globalAlpha=.3,fillText(self.label,self.width/2,self.height/2),globalAlpha=1)}else{var x1=self.lineWidth,y1=self.height-self.val.stop*self.height,x2=self.lineWidth+self.realSpace.x,y2=self.height-self.val.start*self.height;fillRect(x1,y1,x2-x1,y2-y1),nx.showLabels&&(save(),translate(self.width/2,0),rotate(Math.PI/2),textAlign="left",textBaseline="middle",font="bold 15px courier",fillStyle=self.colors.accent,globalAlpha=.3,fillText(self.label,self.width/2,0),globalAlpha=1,restore())}},this.firsttouch="start",this.click=function(){self.firsttouch=self.hslider?Math.abs(self.clickPos.x-self.val.start*self.width)<Math.abs(self.clickPos.x-self.val.stop*self.width)?"start":"stop":Math.abs(Math.abs(self.clickPos.y-self.height)-self.val.start*self.height)<Math.abs(Math.abs(self.clickPos.y-self.height)-self.val.stop*self.height)?"start":"stop",self.move()},this.move=function(){self.hslider?"start"==self.firsttouch?(self.val.start=self.clickPos.x/self.width,self.clickPos.touches.length>1&&(self.val.stop=self.clickPos.touches[1].x/self.width)):(self.val.stop=self.clickPos.x/self.width,self.clickPos.touches.length>1&&(self.val.start=self.clickPos.touches[1].x/self.width)):"start"==self.firsttouch?(self.val.start=nx.invert(self.clickPos.y/self.height),self.clickPos.touches.length>1&&(self.val.stop=nx.invert(self.clickPos.touches[1].y/self.height))):(self.val.stop=nx.invert(self.clickPos.y/self.height),self.clickPos.touches.length>1&&(self.val.start=nx.invert(self.clickPos.touches[1].y/self.height))),self.clicked&&(self.val.stop<self.val.start&&(self.tempstart=self.val.start,self.val.start=self.val.stop,self.val.stop=self.tempstart,self.firsttouch="start"==self.firsttouch?"stop":"start"),self.val={start:nx.clip(self.val.start,0,1),stop:nx.clip(self.val.stop,0,1)},self.val.size=nx.prune(nx.clip(Math.abs(self.val.stop-self.val.start),0,1),3),self.draw()),self.nxTransmit(self.val)}}function sandbox(target){var self=this;this.defaultSize={width:300,height:300},getTemplate(self,target);var i,toySize=60,trashWall=toySize+20,dragging=-1,Toys=new Array,ToyColors=["red","orange","yellow","green","blue","purple","black","pink"],ToyOptions=new Array;for(self.options=4,i=0;i<self.options;i++){var xpos=10+toySize/2,ypos=i*(toySize+12)+11+toySize/2;ToyOptions[i]={color:ToyColors[i%8],xpos:xpos,ypos:ypos,wid:toySize,hgt:toySize}}this.isInsideCircle=function(e,l){return e.x>l.xpos-l.wid/2&&e.x<l.xpos+l.wid/2&&e.y>l.ypos-l.hgt/2&&e.y<l.ypos+l.hgt/2?!0:!1},this.init=function(){self.createUISpaces(),self.drawSpaces(),self.drawToyOptions(),self.drawToys()},this.draw=function(){self.drawSpaces(),self.drawToyOptions(),self.drawToys(),self.drawLabel()},this.createUISpaces=function(){for(self.UISpaces=[{field:"main",xpos:65,ypos:5,wid:self.canvas.width-95,hgt:self.canvas.height-10,hint:"sandbox"},{field:"holder",xpos:5,ypos:5,wid:70,hgt:self.canvas.height-10,hint:""}],i=0;i<this.UISpaces.length;i++)this.UISpaces[i].xpos2=this.UISpaces[i].xpos+this.UISpaces[i].wid,this.UISpaces[i].ypos2=this.UISpaces[i].ypos+this.UISpaces[i].hgt,this.UISpaces[i].centerx=this.UISpaces[i].xpos+this.UISpaces[i].wid/2,this.UISpaces[i].centery=this.UISpaces[i].ypos+this.UISpaces[i].hgt/2},self.click=function(){for(i=0;i<ToyOptions.length;i++)if(self.isInsideCircle(self.clickPos,ToyOptions[i])){var e={xpos:ToyOptions[i].xpos,ypos:ToyOptions[i].xpos,wid:ToyOptions[i].wid,hgt:ToyOptions[i].hgt,color:ToyOptions[i].color,shape:ToyOptions[i].shape};Toys.push(e),dragging=Toys.length-1}for(i=0;i<Toys.length;i++)self.isInsideCircle(self.clickPos,Toys[i])&&(dragging=i);self.nxTransmit([dragging,Toys[dragging].xpos,Toys[dragging].ypos])},self.move=function(){self.clicked&&-1!=dragging&&(Toys[dragging].xpos=self.clickPos.x,Toys[dragging].ypos=self.clickPos.y,self.drawToys(),self.nxTransmit([dragging,Toys[dragging].xpos,Toys[dragging].ypos]))},self.release=function(){for(dragging=-1,i=Toys.length-1;i>-1;i--)Toys[i].xpos<trashWall&&Toys.splice(i,1);self.drawToys()},self.touch=function(e){self.click(e)},self.touchMove=function(e){self.move(e)},self.touchRelease=function(e){self.release(e)},self.drawToyOptions=function(){with(self.context)for(i=0;i<ToyOptions.length;i++)globalAlpha=.4,fillStyle=ToyOptions[i].color,beginPath(),arc(ToyOptions[i].xpos,ToyOptions[i].ypos,toySize/2,2*Math.PI,!1),fill(),closePath(),fillStyle=self.colors.accent,beginPath(),arc(ToyOptions[i].xpos,ToyOptions[i].ypos,toySize/2,2*Math.PI,!1),fill(),globalAlpha=1},self.drawToys=function(){with(self.context){for(clearRect(0,0,self.width,self.height),self.drawSpaces(),self.drawToyOptions(),i=0;i<Toys.length;i++)globalAlpha=.4,fillStyle=Toys[i].color,beginPath(),arc(Toys[i].xpos,Toys[i].ypos,toySize/2,2*Math.PI,!1),fill(),fillStyle=self.colors.accent,beginPath(),arc(Toys[i].xpos,Toys[i].ypos,toySize/2,2*Math.PI,!1),fill();globalAlpha=1}},self.drawSpaces=function(){with(self.context)for(lineWidth=self.lineWidth,strokeStyle=self.colors.border,fillStyle=self.colors.fill,i=0;i<self.UISpaces.length;i++){var space=self.UISpaces[i];nx.makeRoundRect(self.context,space.xpos,space.ypos,space.wid,space.hgt),stroke(),fill()}}}function select(e){var l=this;this.defaultSize={width:200,height:30},getTemplate(l,e),l.choices=[],l.val=new Object,this.init=function(){l.canvas.ontouchstart=null,l.canvas.ontouchmove=null,l.canvas.ontouchend=null,l.canvas.getAttribute("choices")&&(l.choices=l.canvas.getAttribute("choices"),l.choices=l.choices.split(","));var e='<select id="'+l.canvasID+'" style="height:'+l.height+"px;width:"+l.width+"px;font-size:"+l.height/2+'px" onchange="'+l.canvasID+'.change(this)"></select><canvas height="1px" width="1px" style="display:none"></canvas>';$("#"+l.canvasID).replaceWith(e),l.canvas=document.getElementById(l.canvasID);for(var t=0;t<l.choices.length;t++){var s=document.createElement("option");s.text=l.choices[t],s.value=l.choices[t],l.canvas.add(s,null)}},this.change=function(e){l.val.text=e.value,l.nxTransmit(l.val)}}function slider(target){var self=this;this.defaultSize={width:50,height:200},getTemplate(self,target),this.val.value=.7,this.mode="absolute",this.hslider=!1,self.handle,self.relhandle,self.cap,this.init=function(){self.hslider=self.height>=self.width?!1:!0,this.realSpace={x:self.width-2*self.lineWidth,y:self.height-2*self.lineWidth},null!=this.canvas.getAttribute("label")&&(this.label=this.canvas.getAttribute("label")),self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),this.context)if(strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),fillStyle=this.colors.accent,self.hslider){var x1=self.lineWidth,y1=self.lineWidth,x2=self.lineWidth+self.val.value*self.realSpace.x,y2=self.height-self.lineWidth;self.val.value>.01&&fillRect(x1,y1,x2-x1,y2-y1),nx.showLabels&&(textAlign="center",textBaseline="middle",font="bold 15px courier",fillStyle=self.colors.accent,globalAlpha=.3,fillText(self.label,self.width/2,self.height/2),globalAlpha=1)}else{var x1=self.lineWidth,y1=self.height-self.val.value*self.height,x2=self.lineWidth+self.realSpace.x,y2=self.height-self.lineWidth;self.val.value>.01&&fillRect(x1,y1,x2-x1,y2-y1),nx.showLabels&&(save(),translate(self.width/2,0),rotate(Math.PI/2),textAlign="left",textBaseline="middle",font="bold 15px courier",fillStyle=self.colors.accent,globalAlpha=.3,fillText(self.label,self.width/2,0),globalAlpha=1,restore())}},this.click=function(){self.move()},this.move=function(){self.hslider?(self.handle=self.clickPos.x,self.relhandle=self.deltaMove.x,self.cap=self.width):(self.handle=self.clickPos.y,self.relhandle=-1*self.deltaMove.y,self.cap=self.height),"absolute"==self.mode?self.clicked&&(self.val.value=self.hslider?nx.clip(self.clickPos.x/self.width,0,1):Math.abs(nx.clip(self.clickPos.y/self.height,0,1)-1),self.draw()):"relative"==self.mode&&self.clicked&&(self.val.value=self.hslider?nx.clip(self.val.value+self.deltaMove.x/self.width,0,1):nx.clip(self.val.value+-1*self.deltaMove.y/self.height,0,1),self.draw()),self.nxTransmit(self.val)}}function string(target){var self=this;this.defaultSize={width:300,height:200},getTemplate(self,target),this.val={string:0,velocity:0},this.numberofstrings=8,this.strings=new Array,this.abovestring=new Array,this.friction=2;var stringdiv;this.init=function(){stringdiv=self.height/(self.numberofstrings+1);for(var e=0;e<self.numberofstrings;e++)self.strings[e]={x1:self.lineWidth,y1:stringdiv*(1+e),x2:self.width-self.lineWidth,y2:stringdiv*(e+1),held:!1,vibrating:!1,force:0,maxstretch:0,stretch:0,direction:0,above:!1};self.draw(),nx.aniItems.push(self.draw)},this.setStrings=function(e){self.numberofstrings=e,self.strings=new Array,self.init()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),strokeStyle=self.colors.accent;for(var i=0;i<self.strings.length;i++){var st=self.strings[i];st.vibrating?(st.maxstretch<0&&(st.vibrating=!1,st.held=!1),st.stretch=st.stretch+st.direction,Math.abs(st.stretch)>st.maxstretch&&(st.direction*=-1,st.stretch=st.stretch+st.direction,st.maxstretch=st.maxstretch-self.friction,st.direction=st.direction/Math.abs(st.direction)*(st.maxstretch/1)),beginPath(),moveTo(st.x1,st.y1),quadraticCurveTo(self.width/2,st.y1+st.stretch,st.x2,st.y2),stroke(),closePath(),st.on=!0):st.held?(beginPath(),moveTo(st.x1,st.y1),quadraticCurveTo(self.clickPos.x,self.clickPos.y,st.x2,st.y2),stroke(),closePath(),st.on=!0):(beginPath(),moveTo(st.x1,st.y1),lineTo(st.x2,st.y2),stroke(),closePath(),st.on&&(st.on=!1))}}self.drawLabel()},this.click=function(){for(var e=0;e<self.numberofstrings;e++)self.strings[e].above=self.clickPos.y<self.strings[e].y1;self.draw()},this.move=function(){if(self.clicked)for(var e=0;e<self.strings.length;e++)self.strings[e].above!=self.clickPos.y<self.strings[e].y1&&(self.strings[e].held=!0,self.strings[e].above^=!0),self.strings[e].held&&Math.abs(self.clickPos.y-self.strings[e].y1)>self.height/(3*self.strings.length)&&self.pluck(e)},this.release=function(){for(var e=0;e<self.strings.length;e++)self.strings[e].held&&self.pluck(e)},this.pluck=function(e){var l=e;self.val={string:l,x:self.clickPos.x/self.width},self.nxTransmit(self.val),self.strings[l].held=!1,self.strings[l].force=self.clickPos.y-self.strings[l].y1,self.strings[l].maxstretch=Math.abs(self.clickPos.y-self.strings[l].y1),self.strings[l].stretch=self.clickPos.y-self.strings[l].y1,self.strings[l].vibrating=!0,self.strings[l].direction=(self.clickPos.y-self.strings[l].y1)/Math.abs(self.clickPos.y-self.strings[l].y1)*((self.clickPos.y-self.strings[l].y1)/-1.2)}}function template(target,transmitCommand){var self=this;this.defaultSize={width:200,height:200},getTemplate(self,target,transmitCommand),this.val={x:0,y:0,dx:0,dy:0},this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),fillStyle=self.colors.black,textAlign="center",font="12px Gill Sans",fillText("x: "+self.val.x,self.width/2,50),fillText("y: "+self.val.y,self.width/2,75),fillText("x delta: "+self.val.dx,self.width/2,100),fillText("y delta: "+self.val.dy,self.width/2,125);self.drawLabel()},this.click=function(){self.val={x:self.clickPos.x,y:self.clickPos.y,dx:self.deltaMove.x,dy:self.deltaMove.y},self.draw(),self.nxTransmit(self.val)},this.move=function(){self.clicked&&self.click()},this.release=function(){self.click()}}function tilt(target){var self=this;this.defaultSize={width:100,height:100},getTemplate(self,target),this.tiltLR,this.tiltFB,this.z,this.val={x:0,y:0,z:0},this.text="TILT",self.deviceOrientationHandler=function(){self.val={x:nx.prune(self.tiltLR/90,3),y:nx.prune(self.tiltFB/90,3),z:nx.prune(self.z,3)},self.nxTransmit(self.val)},this.init=function(){self.draw(),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(e){self.tiltLR=e.gamma,self.tiltFB=e.beta,self.z=e.alpha,self.deviceOrientationHandler(),self.draw()},!1):window.OrientationEvent?window.addEventListener("MozOrientation",function(e){self.tiltLR=90*e.x,self.tiltFB=-90*e.y,self.z=e.z,self.deviceOrientationHandler(),self.draw()},!1):console.log("Not supported on your device or browser.")},this.draw=function(){with(self.erase(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth;var grd=self.context.createRadialGradient(self.width/3,self.height/5,self.width/20,self.width/3,self.height/5,self.width);grd.addColorStop(0,self.colors.white),grd.addColorStop(1,self.colors.accent),fillStyle=grd,fillStyle=self.colors.fill,fillRect(0,0,self.width,self.height),strokeStyle=self.colors.border,strokeRect(0,0,self.width,self.height),save(),translate(self.width/2,self.height/2),rotate(-self.val.x*Math.PI/2),translate(-self.width/2,-self.height/2),globalAlpha=.4,fillStyle=self.colors.accent,fillRect(-self.width,self.height*(self.val.y/2)+self.height/2,3*self.width,2*self.height),fillStyle=self.colors.accent,font="bold "+self.height/5+"px gill sans",textAlign="center",fillText(self.text,self.width/2,self.height*(self.val.y/2)+self.height/2+self.height/15),globalAlpha=1,restore()
}self.drawLabel()}}function toggle(target){var self=this;this.defaultSize={width:100,height:100},getTemplate(self,target);var mindim=this.height>this.width?this.width:this.height;console.log(mindim),this.fontsize=mindim/6,this.val=0,this.init=function(){self.draw()},this.draw=function(){with(this.context)clearRect(0,0,this.canvas.width,canvas.height);with(this.makeRoundedBG(),this.context)strokeStyle=self.colors.border,fillStyle=self.width>40&&self.height>40?self.colors.fill:self.val?self.colors.accent:self.colors.border,lineWidth=this.lineWidth,stroke(),fill();if(self.width>40&&self.height>40)if(this.val)with(nx.makeRoundRect(this.context,this.bgLeft+this.padding,this.bgTop+this.padding,this.bgWidth-2*this.padding,this.bgHeight/2.1),this.context)fillStyle=self.colors.accent,strokeStyle=self.colors.accent,stroke(),fill(),fillStyle=self.colors.white,font="bold "+self.fontsize+"px gill sans",textAlign="center",fillText("on",this.canvas.width/2,this.bgHeight/4.5+this.lineWidth+this.padding+5);else with(nx.makeRoundRect(this.context,this.bgLeft+this.padding,this.bgBottom-this.padding-this.bgHeight/2.1,this.bgWidth-2*this.padding,this.bgHeight/2.1),this.context)fillStyle=self.colors.border,strokeStyle=self.colors.border,stroke(),fill(),fillStyle=self.colors.white,font="bold "+self.fontsize+"px gill sans",textAlign="center",fillText("off",this.canvas.width/2,this.bgBottom-this.padding-this.bgHeight/4.5+5);else with(this.context)fillStyle=self.colors.white,font="bold "+self.fontsize+"px gill sans",textAlign="center",self.val?fillText("on",this.canvas.width/2,this.canvas.height/2+self.fontsize/3.5):fillText("off",this.canvas.width/2,this.canvas.height/2+self.fontsize/3.5);self.drawLabel()},this.click=function(){self.val=self.val?0:1,self.draw(),self.nxTransmit(self.val)}}function typewriter(target){var self=this;this.defaultSize={width:300,height:100},getTemplate(self,target),this.letter="",this.keywid=self.width/14.5,this.keyhgt=self.height/5,this.val={key:"",ascii:0,on:0},this.rows=[[{symbol:"`",value:192,width:1,on:!1},{symbol:"1",value:49,width:1,on:!1},{symbol:"2",value:50,width:1,on:!1},{symbol:"3",value:51,width:1,on:!1},{symbol:"4",value:52,width:1,on:!1},{symbol:"5",value:53,width:1,on:!1},{symbol:"6",value:54,width:1,on:!1},{symbol:"7",value:55,width:1,on:!1},{symbol:"8",value:56,width:1,on:!1},{symbol:"9",value:57,width:1,on:!1},{symbol:"0",value:48,width:1,on:!1},{symbol:"-",value:189,width:1,on:!1},{symbol:"=",value:187,width:1,on:!1},{symbol:"delete",value:46,width:1.5,on:!1}],[{symbol:"tab",value:10,width:1.5,on:!1},{symbol:"q",value:81,width:1,on:!1},{symbol:"w",value:87,width:1,on:!1},{symbol:"e",value:69,width:1,on:!1},{symbol:"r",value:82,width:1,on:!1},{symbol:"t",value:84,width:1,on:!1},{symbol:"y",value:89,width:1,on:!1},{symbol:"u",value:85,width:1,on:!1},{symbol:"i",value:73,width:1,on:!1},{symbol:"o",value:79,width:1,on:!1},{symbol:"p",value:80,width:1,on:!1},{symbol:"[",value:219,width:1,on:!1},{symbol:"]",value:221,width:1,on:!1},{symbol:"\\",value:220,width:1,on:!1}],[{symbol:"caps",value:20,width:1.75,on:!1},{symbol:"a",value:65,width:1,on:!1},{symbol:"s",value:83,width:1,on:!1},{symbol:"d",value:68,width:1,on:!1},{symbol:"f",value:70,width:1,on:!1},{symbol:"g",value:71,width:1,on:!1},{symbol:"h",value:72,width:1,on:!1},{symbol:"j",value:74,width:1,on:!1},{symbol:"k",value:75,width:1,on:!1},{symbol:"l",value:76,width:1,on:!1},{symbol:";",value:186,width:1,on:!1},{symbol:"'",value:222,width:1,on:!1},{symbol:"enter",value:13,width:1.75,on:!1}],[{symbol:"shift",value:16,width:2.25,on:!1},{symbol:"z",value:90,width:1,on:!1},{symbol:"x",value:88,width:1,on:!1},{symbol:"c",value:67,width:1,on:!1},{symbol:"v",value:86,width:1,on:!1},{symbol:"b",value:66,width:1,on:!1},{symbol:"n",value:78,width:1,on:!1},{symbol:"m",value:77,width:1,on:!1},{symbol:",",value:10,width:1,on:!1},{symbol:".",value:10,width:1,on:!1},{symbol:"/",value:10,width:1,on:!1},{symbol:"shift",value:16,width:2.25,on:!1}],[{symbol:"fn",value:10,width:1,on:!1},{symbol:"ctrl",value:17,width:1,on:!1},{symbol:"opt",value:10,width:1,on:!1},{symbol:"cmd",value:10,width:1.25,on:!1},{symbol:"space",value:32,width:5,on:!1},{symbol:"cmd",value:10,width:1,on:!1},{symbol:"opt",value:10,width:1,on:!1},{symbol:"<",value:37,width:.81,on:!1},{symbol:"^",value:38,width:.81,on:!1},{symbol:"v",value:39,width:.81,on:!1},{symbol:">",value:40,width:.81,on:!1}]],this.init=function(){document.addEventListener("keydown",self.type),document.addEventListener("keyup",self.untype),this.keywid=self.width/14.5,this.keyhgt=self.height/5,self.draw()},this.draw=function(){with(self.erase(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.accent,lineWidth=1;for(var i=0;i<self.rows.length;i++)for(var currkeyL=0,j=0;j<self.rows[i].length;j++)self.val.key==self.rows[i][j].symbol&&(self.rows[i][j].on=self.val.on?!0:!1),nx.makeRoundRect(self.context,currkeyL,i*self.keyhgt,self.keywid*self.rows[i][j].width,self.keyhgt,8),self.rows[i][j].on?(fillStyle=self.colors.accent,strokeStyle=self.colors.accent,fill(),stroke()):(fillStyle=self.colors.fill,strokeStyle=self.colors.border,fill(),stroke()),currkeyL+=self.keywid*self.rows[i][j].width;self.val.on&&(globalAlpha=.3,fillStyle=self.colors.border,font=self.height+"px courier",textAlign="center",fillText(self.val.key,self.width/2,self.height/1.25),globalAlpha=1)}self.drawLabel()},this.click=function(){self.draw()},this.type=function(e){for(var l=e.which,t=0;t<self.rows.length;t++)for(var s=0;s<self.rows[t].length;s++)if(l==self.rows[t][s].value){console.log(self.rows[t][s].symbol),self.val.key=self.rows[t][s].symbol,self.val.on=1,self.val.ascii=e.which,self.nxTransmit(self.val);break}self.draw()},this.untype=function(e){for(var l=e.which,t=0;t<self.rows.length;t++)for(var s=0;s<self.rows[t].length;s++)if(l==self.rows[t][s].value){self.val.key=self.rows[t][s].symbol,self.val.on=0,self.val.ascii=e.which,self.nxTransmit(self.val);break}self.draw()}}function vinyl(target){var self=this;this.defaultSize={width:150,height:150},getTemplate(self,target),this.circleSize=1,this.dial_position_length=6,this.accentWidth=this.width<101||this.width<101?1*this.lineWidth:2*this.lineWidth,this.val=.5,this.responsivity=.005,this.speed=.05,this.spokes=10,this.rotation=0,this.points=new Array,this.init=function(){self.circleSize=Math.min(self.center.x,self.center.y)-self.lineWidth,self.draw(),nx.aniItems.push(self.spin)},this.draw=function(){with(self.context)clearRect(0,0,self.width,self.height),strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,beginPath(),fillStyle=self.colors.black,arc(self.center.x,self.center.y,self.circleSize-5,0,2*Math.PI,!0),fill(),closePath(),beginPath(),fillStyle=self.colors.accent,arc(self.center.x,1*self.center.y,self.circleSize/4,0,2*Math.PI,!1),fill(),closePath(),beginPath(),globalAlpha=.5,fillStyle=self.colors.fill,arc(self.center.x,self.center.y,self.circleSize,self.rotation,self.rotation+.4,!1),lineTo(self.center.x,self.center.y),arc(self.center.x,self.center.y,self.circleSize,self.rotation+Math.PI,self.rotation+Math.PI+.4,!1),lineTo(self.center.x,self.center.y),fill(),globalAlpha=1,closePath(),beginPath(),fillStyle=self.colors.white,arc(self.center.x,1*self.center.y,self.circleSize/16,0,2*Math.PI,!1),fill(),closePath(),lineWidth=4,strokeRect(0,0,self.width,self.height);self.drawLabel()},this.click=function(){self.lastRotation=self.rotation,self.speed=0,self.grabAngle=self.rotation%(2*Math.PI),self.grabPos=nx.toPolar(self.clickPos.x-self.center.x,self.clickPos.y-self.center.y).y},this.move=function(){self.lastRotation2=self.lastRotation,self.lastRotation=self.rotation,self.rotation=nx.toPolar(self.clickPos.x-self.center.x,self.clickPos.y-self.center.y).y+self.grabAngle-self.grabPos,self.draw(),self.val=self.rotation,self.speed=(self.rotation-self.lastRotation+(self.lastRotation-self.lastRotation2))/2,self.nxTransmit(self.val)},this.release=function(){self.speed=(self.rotation-self.lastRotation+(self.lastRotation-self.lastRotation2))/2},this.friction=.995,this.spin=function(){self.lastRotation2=self.lastRotation,self.lastRotation=self.rotation,self.rotation+=self.speed,self.draw(),self.rotation=self.rotation%(2*Math.PI),self.val=self.speed,self.nxTransmit(self.val)}}function wheel(target){var self=this;this.defaultSize={width:150,height:150},getTemplate(self,target),this.circleSize=1,this.dial_position_length=6,this.accentWidth=this.width<101||this.width<101?1*this.lineWidth:2*this.lineWidth,this.val=.5,this.responsivity=.005,this.speed=.05,this.spokes=10,this.rotation=0,this.points=new Array,this.init=function(){self.circleSize=Math.min(self.center.x,self.center.y)-self.lineWidth,self.draw(),nx.aniItems.push(self.spin)},this.draw=function(){with(self.context){clearRect(0,0,self.width,self.height),strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,beginPath(),arc(self.center.x,self.center.y,self.circleSize-5,0,2*Math.PI,!0),fill(),closePath();for(var i=0;i<self.spokes;i++){var dot=nx.toCartesian(self.circleSize-5,i/self.spokes*Math.PI*2-self.rotation+2*Math.PI/(2*self.spokes));beginPath(),arc(dot.x+self.center.x,dot.y+self.center.y,5,0,2*Math.PI,!1),fillStyle=self.colors.accent,fill(),closePath(),beginPath(),globalAlpha=.2,moveTo(self.center.x,1*self.center.y),lineTo(dot.x+self.center.x,dot.y+self.center.y),strokeStyle=self.colors.accent,stroke(),globalAlpha=1,closePath()}lineWidth=2*self.lineWidth,fillStyle=self.colors.fill,strokeStyle=self.colors.accent,strokeRect(self.center.x-3,3,6,self.circleSize),fillRect(self.center.x-3,3,6,self.circleSize),beginPath(),fillStyle=self.colors.fill,strokeStyle=self.colors.accent,stroke(),fill(),closePath(),beginPath(),fillStyle=self.colors.fill,arc(self.center.x,1*self.center.y,self.circleSize/12,0,2*Math.PI,!1),stroke(),fill(),closePath()}self.drawLabel()},this.click=function(){self.lastRotation=self.rotation,self.speed=0,self.grabAngle=self.rotation%(2*Math.PI),self.grabPos=nx.toPolar(self.clickPos.x-self.center.x,self.clickPos.y-self.center.y).y},this.move=function(){if(self.lastRotation2=self.lastRotation,self.lastRotation=self.rotation,self.rotation=nx.toPolar(self.clickPos.x-self.center.x,self.clickPos.y-self.center.y).y+self.grabAngle-self.grabPos,self.draw(),self.rotation<0&&(self.rotation+=2*Math.PI),self.rotation>2*Math.PI&&(self.rotation-=2*Math.PI),self.lastRotation>1.5*Math.PI&&self.rotation<.5*Math.PI&&0!=self.val)self.val=0,self.nxTransmit(self.val);else if(self.lastRotation<.5*Math.PI&&self.rotation>1.5*Math.PI&&0!=self.val)self.val=0,self.nxTransmit(self.val);else for(var e=0;e<self.spokes;e++)console.log(self.rotation),self.rotation-e/self.spokes*Math.PI*2>0&&self.lastRotation-e/self.spokes*Math.PI*2<0&&(self.val=e,self.nxTransmit(self.val)),self.rotation-e/self.spokes*Math.PI*2<0&&self.lastRotation-e/self.spokes*Math.PI*2>0&&(self.val=e,self.nxTransmit(self.val))},this.release=function(){self.speed=(self.rotation-self.lastRotation+(self.lastRotation-self.lastRotation2))/2},this.friction=.995,this.spin=function(){if(self.lastRotation2=self.lastRotation,self.lastRotation=self.rotation,self.rotation+=self.speed,self.speed*=self.friction,self.draw(),self.rotation=self.rotation%(2*Math.PI),self.rotation<0&&(self.rotation+=2*Math.PI),self.rotation>2*Math.PI&&(self.rotation-=2*Math.PI),self.lastRotation>1.5*Math.PI&&self.rotation<.5*Math.PI)self.val=0,self.nxTransmit(self.val);else if(self.lastRotation<.5*Math.PI&&self.rotation>1.5*Math.PI)self.val=0,self.nxTransmit(self.val);else for(var e=0;e<self.spokes;e++)self.rotation-e/self.spokes*Math.PI*2>0&&self.lastRotation-e/self.spokes*Math.PI*2<0&&(self.val=e,self.nxTransmit(self.val)),self.rotation-e/self.spokes*Math.PI*2<0&&self.lastRotation-e/self.spokes*Math.PI*2>0&&(self.val=e,self.nxTransmit(self.val))}}var commentbuffer,nx=function(){var manager=this;this.nxObjects=new Object,this.nxThrottlePeriod=20,this.elemTypeArr=new Array,this.aniItems=new Array,this.editmode=!1,this.isErasing=!1,this.isResizing=!1,this.showLabels=!1,canvasgridy=10,canvasgridx=10,this.starttime=(new Date).getTime(),this.colorize=function(e,l){l||(l=e,e="accent"),manager.colors[e]=l;for(var t in nx.nxObjects)nx.nxObjects[t].colors[e]=l,nx.nxObjects[t].draw()},this.addNxObject=function(e){this.nxObjects[e.canvasID]=e},this.setNxThrottlePeriod=function(e){manager.nxThrottlePeriod=e;for(var l in manager.nxObjects)manager.nxObjects[l].nxThrottlePeriod=manager.nxThrottlePeriod},this.is_touch_device="ontouchstart"in document.documentElement?!0:!1,this.canvasOffset=function(e,l){this.left=e,this.top=l},this.findPosition=function(e){var l=document.body,t=document.defaultView,s=document.documentElement,i=document.createElement("div");i.style.paddingLeft=i.style.width="1px",l.appendChild(i);var o=2==i.offsetWidth;l.removeChild(i),i=e.getBoundingClientRect();var a=s.clientTop||l.clientTop||0,n=s.clientLeft||l.clientLeft||0,f=t.pageYOffset||o&&s.scrollTop||l.scrollTop,h=t.pageXOffset||o&&s.scrollLeft||l.scrollLeft;return{top:i.top+f-a,left:i.left+h-n}},this.getHandlers=function(e){manager.is_touch_device?(e.canvas.ontouchstart=e.preTouch,e.canvas.ontouchmove=e.nxThrottle(e.preTouchMove,e.nxThrottlePeriod),e.canvas.ontouchend=e.preTouchRelease):e.canvas.addEventListener("mousedown",e.preClick,!1)},this.point=function(e,l){this.x=e,this.y=l},this.getCursorPosition=function(e,l){var t,s;void 0!=e.pageX&&void 0!=e.pageY?(t=e.pageX,s=e.pageY):(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,s=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),t-=l.left,s-=l.top;var i=new nx.point(t,s);return i.touches=[{x:t,y:s}],i},this.getTouchPosition=function(e,l){var t,s;t=e.targetTouches[0].pageX,s=e.targetTouches[0].pageY,t-=l.left,s-=l.top;var i=new nx.point(t,s);console.log("touches="+e.touches.length),console.log("target="+e.targetTouches.length),console.log("changed="+e.changedTouches.length),i.touches=new Array;for(var o=0;o<e.targetTouches.length;o++)i.touches.push({x:e.targetTouches[o].pageX-l.left,y:e.targetTouches[o].pageY-l.top});return i},this.nxThrottle=function(e,l){var t;return function(){var s=this,i=arguments;t||(t=setTimeout(function(){t=null;try{e.apply(s,i)}catch(l){console.log(l)}},l))}},this.toCartesian=function(e,l){var t=Math.cos(l),s=Math.sin(l),i=new nx.point(e*t,e*s*-1);return i},this.toPolar=function(e,l){var t=Math.sqrt(e*e+l*l),s=Math.atan2(l,e);0>s&&(s+=2*Math.PI);var i=new nx.point(t,s);return i},this.clip=function(e,l,t){var s=Math.min(t,Math.max(l,e));return s},this.text=function(context,text,position){with(position||(position=[10,10]),context)beginPath(),font="bold 12px sans-serif",fillText(text,position[0],position[1]),closePath()},this.drawLabel=function(){if(manager.showLabels)with(this.context)globalAlpha=.9,fillStyle=this.colors.fill,fillRect(this.width-100,this.height-20,100,20),globalAlpha=1,beginPath(),fillStyle=this.colors.border,font="bold 15px courier",textAlign="center",fillText(this.canvasID,this.width-50,this.height-5),textAlign="left",closePath()},this.boolToVal=function(e){return e?1:0},this.prune=function(e,l){var l=Math.pow(10,l);if("number"==typeof e)e=Math.round(e*l)/l;else if(e instanceof Array)for(var t=0;t<e.length;t++)"number"==typeof e[t]&&(e[t]=Math.round(e[t]*l)/l);return e},this.scale=function(e,l,t,s,i){return outNum=(e-l)*(i-s)/(t-l)+s},this.invert=function(e){return manager.scale(e,1,0,0,1)},this.mtof=function(e){var l=440*Math.pow(2,(e-69)/12);return l},this.colors={accent:"#ff5500",fill:"#f5f5f5",border:"#999",accentborder:"#aa2200",black:"#000",white:"#FFF",highlight:"rgba(255,85,0,0.5)"},this.randomNum=function(e){var l=Math.floor(Math.random()*e);return l},this.randomColor=function(){var e="rgb("+this.randomNum(250)+","+this.randomNum(250)+","+this.randomNum(250)+")";return e},this.hexToRgb=function(e,l){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,l,t,s){return l+l+t+t+s+s});var s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);l||(l=.5);var i=parseInt(s[1],16),o=parseInt(s[2],16),a=parseInt(s[3],16);return"rgba("+i+","+o+","+a+","+l+")"},this.makeRoundRect=function(e,l,t,s,i,o){var a=l,n=t,f=s+a,h=i+n;o||(o=2),e.beginPath(),e.moveTo(a+o,n),e.lineTo(f-o,n),e.quadraticCurveTo(f,n,f,n+o),e.lineTo(f,h-o),e.quadraticCurveTo(f,h,f-o,h),e.lineTo(a+o,h),e.quadraticCurveTo(a,h,a,h-o),e.lineTo(a,n+o),e.quadraticCurveTo(a,n,a+o,n),e.closePath()},this.isInside=function(e,l){return e.x>l.xpos&&e.x<l.xpos+l.wid&&e.y>l.ypos&&e.y<l.ypos+l.hgt?!0:!1},this.blockMove=function(e){"CANVAS"==e.target.tagName&&e.preventDefault()},this.startPulse=function(){manager.pulseInt=setInterval("nx.pulse()",30)},this.stopPulse=function(){clearInterval(manager.pulseInt)},this.pulse=function(){for(var e=0;e<manager.aniItems.length;e++)manager.aniItems[e]()},this.bounce=function(e,l,t,s){return e>l&&t>e?s:l>=e?Math.abs(s):e>=t?-1*Math.abs(s):void 0},this.addStylesheet=function(){var e="<style>select {background: transparent;-webkit-appearance: none;width: 150px;padding: 5px 5px;font-size: 16px;color:#888;border: solid 2px #CCC;border-radius: 6;outline: black;cursor:pointer;background-color:#F7F7F7;font-family:gill sans;}canvas { cursor:pointer; }</style>";document.body.innerHTML=document.body.innerHTML+e},this.wrapText=function(e,l,t,s,i,o){if(l){for(var a=l.split(" "),n="",f=0;f<a.length;f++){var h=n+a[f]+" ",c=e.measureText(h),r=c.width;r>i&&f>0?(e.fillText(n,t,s),n=a[f]+" ",s+=o):n=h}e.fillText(n,t,s)}},this.metas=document.getElementsByTagName("meta"),this.setViewport=function(e){for(i=0;i<manager.metas.length;i++)"viewport"==manager.metas[i].name&&(manager.metas[i].content="minimum-scale="+e+", maximum-scale="+e)},this.highlightEditedObj=function(){for(var e=document.getElementsByTagName("canvas"),l=0;l<e.length;l++)e[l].style.zindex+="1";var t=document.getElementsByTagName(globaldragid);t.style.zindex=2},this.setLabels=function(e){manager.showLabels="on"==e?!0:!1;for(var l in manager.nxObjects)manager.nxObjects[l].draw()},this.saveCanv=function(e){var l=e.canvas.toDataURL("image/png").replace("image/png","image/octet-stream");window.location.href=l}},nx=new nx;nx.onload=function(){},window.onload=initNX;